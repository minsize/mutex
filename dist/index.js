"use strict";exports.Mutex=t=>{const e={};let i=0;const o=t=>{const o=e[`${t?.key}`];o&&(0!==o.r.length&&o.r.sort(((t,e)=>t[1]-e[1])).shift()?.[0](t),o.l--),i--};return{wait:r=>new Promise(((s,l)=>{let n=e[`${r?.key}`];n||(n={l:0,r:[]},e[`${r?.key}`]=n);const m=r?.limit&&n.l>=r.limit||i>=(t?.globalLimit||1),u=m&&t?.timeout?setTimeout((()=>{const t=new Error("timeout");t.code=1,l(t)}),t.timeout):void 0,c=()=>s((()=>{clearTimeout(u),o(r)}));m&&n.r.push([c,r?.index||0]),i++,n.l++,m||c()})),release:o}};
