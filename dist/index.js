"use strict";exports.Mutex=t=>{const e=new Map;let i=0;const o=t=>{const o=e.get(`${t?.key}`);o&&(0!==o.r.length&&o.r.shift()(t),o.l--,e.set(`${t?.key}`,o)),i--};return{wait:s=>new Promise(((r,l)=>{const n=e.get(`${s?.key}`)||{l:0,r:[]},m=s?.limit&&n.l>=s.limit||i>=(t?.globalLimit||1),u=m&&t?.timeout?setTimeout((()=>{const t=new Error("timeout");t.code=1,l(t)}),t.timeout):void 0,c=()=>r((()=>{clearTimeout(u),o(s)}));m&&n.r.push(c),i++,n.l++,e.set(`${s?.key}`,n),m||c()})),release:o}};
